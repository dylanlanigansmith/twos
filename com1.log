using Serial COM1 for debug out 
boot start
registered interupt handler for [33] at 0xffffffff80211162
registered interupt handler for [32] at 0xffffffff80210e42
registered interupt handler for [105] at 0xffffffff8020ccfd
==init GDT, TSS==
gdt ptr = 0xffffffff80214000, tss ptr = 0xffffffff80214028 tss - gdt = 0x28
stack top = 0xffffffff8021d000 end = 0xffffffff80219000 size = 0x4000
copied GDT tss to 0xffffffff80217bf0
==Reloaded GDT, Loaded TSS==
interupts initialized
==boot initial phase complete==

CPUID available = YES
==Parsing Multiboot2 Header==
Unhandled Multiboot Tag: 10
Found Multiboot Module at 0x22b000. Total: 1
Unhandled Multiboot Tag: 9
Unhandled Multiboot Tag: 5
found VBE
fb @ 0xfc000000 h= 768 p= 4096 
===MULTIBOOT_TAG_TYPE_ACPI_OLD===
==parsed mb2 header==
boot info: BIOS [GRUB 2.12] cmdline='dbg=1 serial=1 hackz=1337' kernel_base=0x200000

==PMM Init==
Available Memory Region [0]:{ @0x0 - 0x9fc00 } size 0x9fc00 [0 MiB] 
Available Memory Region [3]:{ @0x100000 - 0xbffe0000 } size 0xbfee0000 [3070 MiB] 
Available Memory Region [7]:{ @0x100000000 - 0x240000000 } size 0x140000000 [5120 MiB] 
Total Memory:
    8388095 KiB  /  8191 MiB  /  7 GiB
 Total Pages: 4095 

for region 0x0 - 0x9fc00 there are 0 pages (r 639 kb) to set free
for region 0x100000 - 0xbffe0000 there are 1535 pages (r 896 kb) to set free
aligned start 0x200000 - aligned end 0xbfe00000 (1 1) 
for region 0x100000000 - 0x240000000 there are 2560 pages (r 0 kb) to set free
marking from kernel phys start 0x200000 to kernel phys end 0x22b000 as used
mark region used: 0x200000 - 0x22b000
marking from 0x200000 - 0x400000 as used, total pages = 1
mark region used: 0x0 - 0xe2b000
marking from 0x0 - 0xe56000 as used, total pages = 7
==PMM End==
mark region used: 0x22b000 - 0x1309060
marking from 0x200000 - 0x13bc0c0 as used, total pages = 8
==init paging==
mark region used: 0xfc000000 - 0xfc300000
marking from 0xfc000000 - 0xfc400000 as used, total pages = 2
unmapping initial identity
palloc_init()
pmm_kalloc(0x400000): found space for 2 pages at 0x1200000
map_phys_addr():  0x1200000 -> 0xffffffff81200000 | 2 pages 
idx for VA: 0xffffffff81200000 [0b1111 1111 1111 1111 1111 1111 1111 1111 1000 0001 0010 0000 0000 0000 0000 0000 ] 
 p4[511] p3[510] p2[9] p1[0] 
p4 = 0x21f000
p4 = 0xffffffff8021f000
p4->[p3ind]=0x223000
initial p3 = 0xffffffff80223000 p4 = 0xffffffff8021f000, p3_phys = 0xffffffff8020b3e8  
we have: p3 = 0xffffffff80223000 p2 = 0x222000 
making p3 virtual: now 0xffffffff80223000 
making p2 virtual: now 0xffffffff80223000 
entry 0 @ 0xffffffff80222240 = 0x1200083 
 0b0000 0000 0000 0000 0000 0000 0000 0000 0000 0001 0010 0000 0000 0000 1000 0011 
entry 1 @ 0xffffffff80222280 = 0x1400083 
 0b0000 0000 0000 0000 0000 0000 0000 0000 0000 0001 0100 0000 0000 0000 1000 0011 
==flushed TLB==
invalidated: 0xffffffff81200000 
page allocator ready at 0xffffffff81200000
mapping framebuffer 0xfc000000 to 0xfc000000
map_phys_addr():  0xfc000000 -> 0xfc000000 | 2 pages 
idx for VA: 0xfc000000 [0b0000 0000 0000 0000 0000 0000 0000 0000 1111 1100 0000 0000 0000 0000 0000 0000 ] 
 p4[0] p3[3] p2[480] p1[0] 
p4 = 0x21f000
p4 = 0xffffffff8021f000
initial p3 = 0x0 p4 = 0xffffffff8021f000, p3_phys = 0xffffffff8020b3e8  
alloc new page table at 0x1200000, virtual 0xffffffff81200000, index now 1 
alloc new page table at 0x1201000, virtual 0xffffffff81201000, index now 2 
made new: **p3 = 0x1200000 p2 = 0x1201000 entry = 0b0000 0000 0000 0000 0000 0000 0000 0000 0000 0001 0010 0000 0000 0000 0000 0111  
we have: p3 = 0x1200000 p2 = 0x1201000 
making p3 virtual: now 0xffffffff81200000 
making p2 virtual: now 0xffffffff81200000 
entry 0 @ 0xffffffff81208800 = 0xfc000083 
 0b0000 0000 0000 0000 0000 0000 0000 0000 1111 1100 0000 0000 0000 0000 1000 0011 
entry 1 @ 0xffffffff81208840 = 0xfc200083 
 0b0000 0000 0000 0000 0000 0000 0000 0000 1111 1100 0010 0000 0000 0000 1000 0011 
==flushed TLB==
invalidated: 0xfc000000 
init_heap()
pmm_kalloc(0x800000): found space for 4 pages at 0x1800000
map_phys_addr():  0x1800000 -> 0xffffbeefed000000 | 4 pages 
idx for VA: 0xffffbeefed000000 [0b1111 1111 1111 1111 1011 1110 1110 1111 1110 1101 0000 0000 0000 0000 0000 0000 ] 
 p4[381] p3[447] p2[360] p1[0] 
p4 = 0x21f000
p4 = 0xffffffff8021f000
initial p3 = 0x0 p4 = 0xffffffff8021f000, p3_phys = 0xffffffff8020b3e8  
alloc new page table at 0x1202000, virtual 0xffffffff81202000, index now 3 
alloc new page table at 0x1203000, virtual 0xffffffff81203000, index now 4 
made new: **p3 = 0x1202000 p2 = 0x1203000 entry = 0b0000 0000 0000 0000 0000 0000 0000 0000 0000 0001 0010 0000 0010 0000 0000 0111  
we have: p3 = 0x1202000 p2 = 0x1203000 
making p3 virtual: now 0xffffffff81202000 
making p2 virtual: now 0xffffffff81202000 
entry 0 @ 0xffffffff81208a00 = 0x1800083 
 0b0000 0000 0000 0000 0000 0000 0000 0000 0000 0001 1000 0000 0000 0000 1000 0011 
entry 1 @ 0xffffffff81208a40 = 0x1a00083 
 0b0000 0000 0000 0000 0000 0000 0000 0000 0000 0001 1010 0000 0000 0000 1000 0011 
entry 2 @ 0xffffffff81208a80 = 0x1c00083 
 0b0000 0000 0000 0000 0000 0000 0000 0000 0000 0001 1100 0000 0000 0000 1000 0011 
entry 3 @ 0xffffffff81208ac0 = 0x1e00083 
 0b0000 0000 0000 0000 0000 0000 0000 0000 0000 0001 1110 0000 0000 0000 1000 0011 
==flushed TLB==
invalidated: 0xffffbeefed000000 
bmap [ 0xffffbeefed000000 ] size=0 
max size = 262130 max_size_bytes = 0x200000 
==paging init ok==
skipping acpi

==MEM INIT OK==
enabled interupts.
==boot second phase complete==
making new block at 0xffffbeefed200000 size=94 /  footer @ 0xffffbeefed200052 
adding to alloc map, prev. # allocs = 0 
 added to alloc map, new # allocs = 1 
freeing block at 0xffffbeefed200000 / block_size=81 
block freed, size of allocs = 1 
===initrd: loading 17686624 bytes from 0x22b000===
initrd validated; contains 17682824 bytes of files!
we found no space to fit size 0x1425, making new block at 0xffffbeefed20005e size=5182 /  footer @ 0xffffbeefed201490 
adding to alloc map, prev. # allocs = 1 
 added to alloc map, new # allocs = 2 
we found no space to fit size 0x5aa, making new block at 0xffffbeefed20149c size=1475 /  footer @ 0xffffbeefed201a53 
adding to alloc map, prev. # allocs = 2 
 added to alloc map, new # allocs = 3 
added dir node mod 
added dir node local 
added dir node libnest 
added dir node lib 
added dir node usr 
added dir node books 
added dir node etc 
added dir node birds 
added dir node bin 
added file node ulysses.txt 
added file node LICENSE.txt 
added file node initrd.txt 
added file node etcetera.txt 
added file node init 
added file node ls 
added file node DOOM.iwad 
added file node usermode 
added file node doomos 
added file node loco.txt 
added file node usrlocal.txt 
added file node libd.so 
added file node imaginehavingalongfilenamewellyoudonthavetoanymore.txt 
added file node greenland.bmp 
added file node birdnest.nice 
added file node testcase.txt 
==initrd load success!== 

file init is valid elf64. loading..
phdr load  vaddr = 0x400000, aligned to 0x1000, X  R  
phdr load  vaddr = 0x403000, aligned to 0x1000,  W R  
lowest vaddr 0x400000 highest vaddr 0x4037a0, size 0x200000
pmm_alloc(0x400000): found space for 2 pages at 0x40000000
map_phys_addr():  0x40000000 -> 0x400000 | 2 pages 
idx for VA: 0x400000 [0b0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0100 0000 0000 0000 0000 0000 ] 
 p4[0] p3[0] p2[2] p1[0] 
p4 = 0x21f000
p4 = 0xffffffff8021f000
p4->[p3ind]=0x1200000
initial p3 = 0xffffffff81200000 p4 = 0xffffffff8021f000, p3_phys = 0xffffffff8020b3e8  
alloc new page table at 0x1204000, virtual 0xffffffff81204000, index now 5 
made new: p2
we have: p3 = 0xffffffff81200000 p2 = 0x1204000 
making p3 virtual: now 0xffffffff81200000 
making p2 virtual: now 0xffffffff81200000 
entry 0 @ 0xffffffff81204080 = 0x40000087 
 0b0000 0000 0000 0000 0000 0000 0000 0000 0100 0000 0000 0000 0000 0000 1000 0111 
entry 1 @ 0xffffffff812040c0 = 0x40200087 
 0b0000 0000 0000 0000 0000 0000 0000 0000 0100 0000 0010 0000 0000 0000 1000 0111 
==flushed TLB==
invalidated: 0x400000 
allocated user pages: [phys address] =  p4 0x403fd000 p3 0x403fe000 p2 0x403ff000
 [virt] vstart = 0x400000 vend = 0x800000, size palign 0x200000 size total 0x400000
map_user_page_tables:  0x40000000 -> 0x400000 | 2 pages 
idx for VA: 0x400000 [0b0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0100 0000 0000 0000 0000 0000 ] 
 p4[0] p3[0] p2[2] p1[0] 
kp4 phys = 0x21f000
kp4 virt = 0xffffffff8021f000
copying kp4 at idx 511 (contents 0x223023) to user p4
idx for VA: 0x400000 [0b0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0100 0000 0000 0000 0000 0000 ] 
 p4[0] p3[0] p2[2] p1[0] 
idx for VA: 0xffffbeefed000000 [0b1111 1111 1111 1111 1011 1110 1110 1111 1110 1101 0000 0000 0000 0000 0000 0000 ] 
 p4[381] p3[447] p2[360] p1[0] 
idx for VA: 0xfc000000 [0b0000 0000 0000 0000 0000 0000 0000 0000 1111 1100 0000 0000 0000 0000 0000 0000 ] 
 p4[0] p3[3] p2[480] p1[0] 
usr stack @ 0x7fd000, size = 4070 kb
copying header 0x400000 to 0x400000. fs= 0x2ee8 ms = 0x2ee8
copying header 0x403000 to 0x403000. fs= 0x618 ms = 0x7a0
unmap_phys_addr():  unmapping 0x400000  | 2 pages 
idx for VA: 0x400000 [0b0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0100 0000 0000 0000 0000 0000 ] 
 p4[0] p3[0] p2[2] p1[0] 
p4 = 0xffffffff8021f000
p4->[p3ind]=0x1200000
we have: p3 = 0xffffffff81200000 p2 = 0x1204000 
making p2 virtual: now 0xffffffff81200000 
==flushed TLB==
invalidated: 0x400000 
loaded ELF: init [14240 kb]
 usr entry = 0x4005fb usr phys = 0x40000000 usr lo 0x400000 usr rsp 0x7fd000, usr cr3 = 0x403fd000
we found no space to fit size 0x1000, making new block at 0xffffbeefed201a5f size=4121 /  footer @ 0xffffbeefed202a6c 
adding to alloc map, prev. # allocs = 3 
 added to alloc map, new # allocs = 4 

=== stdout init @ 0xffffbeefed201a6c size 4096 idx 0  ready = 1 ===
Graphics Init 1024 x 768 x 32 ready = 1 
tasking init

we found no space to fit size 0x2000, making new block at 0xffffbeefed202a78 size=8217 /  footer @ 0xffffbeefed204a85 
adding to alloc map, prev. # allocs = 4 
 added to alloc map, new # allocs = 5 
stack  0xffffbeefed204974 isn't aligned! repairing to = 0xffffbeefed204970 
create_task task_kmain pid 0 rip 0xffffffff80201787 !
added initial task task_kmain pid 0 !
adding task task_drawstdout, pid_last = 1 !
we found no space to fit size 0x2000, making new block at 0xffffbeefed204a91 size=8217 /  footer @ 0xffffbeefed206a9e 
adding to alloc map, prev. # allocs = 5 
 added to alloc map, new # allocs = 6 
stack  0xffffbeefed20698d isn't aligned! repairing to = 0xffffbeefed206980 
create_task task_drawstdout pid 1 rip 0xffffffff80201954 !
scheduler: added task task_drawstdout, pid = 1 !
adding task task_exit_test, pid_last = 2 !
we found no space to fit size 0x2000, making new block at 0xffffbeefed206aaa size=8217 /  footer @ 0xffffbeefed208ab7 
adding to alloc map, prev. # allocs = 6 
 added to alloc map, new # allocs = 7 
stack  0xffffbeefed2089a6 isn't aligned! repairing to = 0xffffbeefed2089a0 
create_task task_exit_test pid 2 rip 0xffffffff80201a43 !
scheduler: added task task_exit_test, pid = 2 !
adding task task_yield_test, pid_last = 3 !
we found no space to fit size 0x2000, making new block at 0xffffbeefed208ac3 size=8217 /  footer @ 0xffffbeefed20aad0 
adding to alloc map, prev. # allocs = 7 
 added to alloc map, new # allocs = 8 
stack  0xffffbeefed20a9bf isn't aligned! repairing to = 0xffffbeefed20a9b0 
create_task task_yield_test pid 3 rip 0xffffffff80201a74 !
scheduler: added task task_yield_test, pid = 3 !
adding USER task usermode, pid_last = 4 !
we found no space to fit size 0x2000, making new block at 0xffffbeefed20aadc size=8217 /  footer @ 0xffffbeefed20cae9 
adding to alloc map, prev. # allocs = 8 
 added to alloc map, new # allocs = 9 
stack  0xffffbeefed20c9d8 isn't aligned! repairing to = 0xffffbeefed20c9d0 
create_task usermode pid 4 rip 0x4005fb !
we found no space to fit size 0x70, making new block at 0xffffbeefed20caf5 size=137 /  footer @ 0xffffbeefed20cb72 
adding to alloc map, prev. # allocs = 9 
 added to alloc map, new # allocs = 10 
scheduler: added USER task usermode, pid = 4 !
randos up 
starting first task task_kmain
starting task task_kmain
task draw timer 
task draw test 
task exit test 
task 2 exited with code: 0
found task task_drawstdout pointing to del task task_exit_test
old parent pid = 65535
yield testI am a user task hard at work
please mr kernel give me cpu time

115$>>> yieldingyieldingyieldingyieldingyield test overtask 3 exited with code: 0
found task task_drawstdout pointing to del task task_yield_test
old parent pid = 65535
1put char 1 49 
put char  8 
dput char d 100 
oput char o 111 
oput char o 111 
mput char m 109 
put char  13 
 
found space at 0. need size 0x6 found size 0x51 
using existing block at 0xffffbeefed200000 / block_size=81 
exec_user_task(): old cr3 0x403fd000 new cr3 0x21f000 insane 0x403fd000 wtf 0xffffbeefed200008
file doomos is valid elf64. loading..
phdr load  vaddr = 0x400000, aligned to 0x1000, X  R  
phdr load  vaddr = 0x471120, aligned to 0x1000,  W R  
lowest vaddr 0x400000 highest vaddr 0x4d5500, size 0x200000
pmm_alloc(0x400000): found space for 2 pages at 0x40600000
map_phys_addr():  0x40600000 -> 0x400000 | 2 pages 
idx for VA: 0x400000 [0b0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0100 0000 0000 0000 0000 0000 ] 
 p4[0] p3[0] p2[2] p1[0] 
p4 = 0x21f000
p4 = 0xffffffff8021f000
p4->[p3ind]=0x1200000
initial p3 = 0xffffffff81200000 p4 = 0xffffffff8021f000, p3_phys = 0xffffffff8020b3e8  
we have: p3 = 0xffffffff81200000 p2 = 0x1204000 
making p3 virtual: now 0xffffffff81200000 
making p2 virtual: now 0xffffffff81200000 
entry 0 @ 0xffffffff81204080 = 0x40600087 
 0b0000 0000 0000 0000 0000 0000 0000 0000 0100 0000 0110 0000 0000 0000 1000 0111 
entry 1 @ 0xffffffff812040c0 = 0x40800087 
 0b0000 0000 0000 0000 0000 0000 0000 0000 0100 0000 1000 0000 0000 0000 1000 0111 
==flushed TLB==
invalidated: 0x400000 
allocated user pages: [phys address] =  p4 0x409fd000 p3 0x409fe000 p2 0x409ff000
 [virt] vstart = 0x400000 vend = 0x800000, size palign 0x200000 size total 0x400000
map_user_page_tables:  0x40600000 -> 0x400000 | 2 pages 
idx for VA: 0x400000 [0b0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0100 0000 0000 0000 0000 0000 ] 
 p4[0] p3[0] p2[2] p1[0] 
kp4 phys = 0x21f000
kp4 virt = 0xffffffff8021f000
copying kp4 at idx 511 (contents 0x223023) to user p4
idx for VA: 0x400000 [0b0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0100 0000 0000 0000 0000 0000 ] 
 p4[0] p3[0] p2[2] p1[0] 
idx for VA: 0xffffbeefed000000 [0b1111 1111 1111 1111 1011 1110 1110 1111 1110 1101 0000 0000 0000 0000 0000 0000 ] 
 p4[381] p3[447] p2[360] p1[0] 
idx for VA: 0xfc000000 [0b0000 0000 0000 0000 0000 0000 0000 0000 1111 1100 0000 0000 0000 0000 0000 0000 ] 
 p4[0] p3[3] p2[480] p1[0] 
usr stack @ 0x7fd000, size = 3230 kb
copying header 0x400000 to 0x400000. fs= 0x70118 ms = 0x70118
copying header 0x471120 to 0x471120. fs= 0x21c78 ms = 0x643e0
unmap_phys_addr():  unmapping 0x400000  | 2 pages 
idx for VA: 0x400000 [0b0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0100 0000 0000 0000 0000 0000 ] 
 p4[0] p3[0] p2[2] p1[0] 
p4 = 0xffffffff8021f000
p4->[p3ind]=0x1200000
we have: p3 = 0xffffffff81200000 p2 = 0x1204000 
making p2 virtual: now 0xffffffff81200000 
==flushed TLB==
invalidated: 0x400000 
loaded ELF: doomos [873728 kb]
exec_user_task():
     usr entry = 0x43ebc5 usr phys = 0x40600000 usr lo 0x400000 usr rsp 0x7fd000, usr cr3 = 0x409fd000
adding USER task doomos, child of 4 !
we found no space to fit size 0x2000, making new block at 0xffffbeefed20cb7e size=8217 /  footer @ 0xffffbeefed20eb8b 
adding to alloc map, prev. # allocs = 10 
 added to alloc map, new # allocs = 11 
stack  0xffffbeefed20ea7a isn't aligned! repairing to = 0xffffbeefed20ea70 
create_task doomos pid 5 rip 0x43ebc5 !
we found no space to fit size 0x70, making new block at 0xffffbeefed20eb97 size=137 /  footer @ 0xffffbeefed20ec14 
adding to alloc map, prev. # allocs = 11 
 added to alloc map, new # allocs = 12 
scheduler: added child user task doomos, pid = 5 !
scheduler: swapping back cr3 to 0x403fd000
starting doom!
allocated a heap for task 5
pmm_alloc(0x200000): found space for 1 pages at 0x40c00000
map_phys_addr():  0x40600000 -> 0x400000 | 2 pages 
idx for VA: 0x400000 [0b0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0100 0000 0000 0000 0000 0000 ] 
 p4[0] p3[0] p2[2] p1[0] 
p4 = 0x21f000
p4 = 0xffffffff8021f000
p4->[p3ind]=0x1200000
initial p3 = 0xffffffff81200000 p4 = 0xffffffff8021f000, p3_phys = 0xffffffff8020b3e8  
we have: p3 = 0xffffffff81200000 p2 = 0x1204000 
making p3 virtual: now 0xffffffff81200000 
making p2 virtual: now 0xffffffff81200000 
entry 0 @ 0xffffffff81204080 = 0x40600087 
 0b0000 0000 0000 0000 0000 0000 0000 0000 0100 0000 0110 0000 0000 0000 1000 0111 
entry 1 @ 0xffffffff812040c0 = 0x40800087 
 0b0000 0000 0000 0000 0000 0000 0000 0000 0100 0000 1000 0000 0000 0000 1000 0111 
==flushed TLB==
invalidated: 0x400000 
map_user_page_tables:  0x40c00000 -> 0x800000 | 1 pages 
idx for VA: 0x800000 [0b0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 1000 0000 0000 0000 0000 0000 ] 
 p4[0] p3[0] p2[4] p1[0] 
unmap_phys_addr():  unmapping 0x400000  | 2 pages 
idx for VA: 0x400000 [0b0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0100 0000 0000 0000 0000 0000 ] 
 p4[0] p3[0] p2[2] p1[0] 
p4 = 0xffffffff8021f000
p4->[p3ind]=0x1200000
we have: p3 = 0xffffffff81200000 p2 = 0x1204000 
making p2 virtual: now 0xffffffff81200000 
==flushed TLB==
invalidated: 0x400000 
allocated a heap for task 5:
        pa 0x40c00000 va0x800000 size 2048 kb 
 cr3 to restore: 0x409fd000 
created frame buffer
mmap WAD

 task_mmap_file(): DOOM.iwad to be mmaped in 6 pages from 0xffffffff803ababb
pmm_alloc(0xc00000): found space for 6 pages at 0x41000000
map_phys_addr():  0x40600000 -> 0x400000 | 2 pages 
idx for VA: 0x400000 [0b0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0100 0000 0000 0000 0000 0000 ] 
 p4[0] p3[0] p2[2] p1[0] 
p4 = 0x21f000
p4 = 0xffffffff8021f000
p4->[p3ind]=0x1200000
initial p3 = 0xffffffff81200000 p4 = 0xffffffff8021f000, p3_phys = 0xffffffff8020b3e8  
we have: p3 = 0xffffffff81200000 p2 = 0x1204000 
making p3 virtual: now 0xffffffff81200000 
making p2 virtual: now 0xffffffff81200000 
entry 0 @ 0xffffffff81204080 = 0x40600087 
 0b0000 0000 0000 0000 0000 0000 0000 0000 0100 0000 0110 0000 0000 0000 1000 0111 
entry 1 @ 0xffffffff812040c0 = 0x40800087 
 0b0000 0000 0000 0000 0000 0000 0000 0000 0100 0000 1000 0000 0000 0000 1000 0111 
==flushed TLB==
invalidated: 0x400000 
map_phys_addr():  0x41000000 -> 0x20000000 | 6 pages 
idx for VA: 0x20000000 [0b0000 0000 0000 0000 0000 0000 0000 0000 0010 0000 0000 0000 0000 0000 0000 0000 ] 
 p4[0] p3[0] p2[256] p1[0] 
p4 = 0x21f000
p4 = 0xffffffff8021f000
p4->[p3ind]=0x1200000
initial p3 = 0xffffffff81200000 p4 = 0xffffffff8021f000, p3_phys = 0xffffffff8020b3e8  
we have: p3 = 0xffffffff81200000 p2 = 0x1204000 
making p3 virtual: now 0xffffffff81200000 
making p2 virtual: now 0xffffffff81200000 
entry 0 @ 0xffffffff81208000 = 0x41000087 
 0b0000 0000 0000 0000 0000 0000 0000 0000 0100 0001 0000 0000 0000 0000 1000 0111 
entry 1 @ 0xffffffff81208040 = 0x41200087 
 0b0000 0000 0000 0000 0000 0000 0000 0000 0100 0001 0010 0000 0000 0000 1000 0111 
entry 2 @ 0xffffffff81208080 = 0x41400087 
 0b0000 0000 0000 0000 0000 0000 0000 0000 0100 0001 0100 0000 0000 0000 1000 0111 
entry 3 @ 0xffffffff812080c0 = 0x41600087 
 0b0000 0000 0000 0000 0000 0000 0000 0000 0100 0001 0110 0000 0000 0000 1000 0111 
entry 4 @ 0xffffffff81208100 = 0x41800087 
 0b0000 0000 0000 0000 0000 0000 0000 0000 0100 0001 1000 0000 0000 0000 1000 0111 
entry 5 @ 0xffffffff81208140 = 0x41a00087 
 0b0000 0000 0000 0000 0000 0000 0000 0000 0100 0001 1010 0000 0000 0000 1000 0111 
==flushed TLB==
invalidated: 0x20000000 
map_user_page_tables:  0x41000000 -> 0x20000000 | 6 pages 
idx for VA: 0x20000000 [0b0000 0000 0000 0000 0000 0000 0000 0000 0010 0000 0000 0000 0000 0000 0000 0000 ] 
 p4[0] p3[0] p2[256] p1[0] 
unmap_phys_addr():  unmapping 0x400000  | 2 pages 
idx for VA: 0x400000 [0b0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0100 0000 0000 0000 0000 0000 ] 
 p4[0] p3[0] p2[2] p1[0] 
p4 = 0xffffffff8021f000
p4->[p3ind]=0x1200000
we have: p3 = 0xffffffff81200000 p2 = 0x1204000 
making p2 virtual: now 0xffffffff81200000 
==flushed TLB==
invalidated: 0x400000 
unmap_phys_addr():  unmapping 0x20000000  | 6 pages 
idx for VA: 0x20000000 [0b0000 0000 0000 0000 0000 0000 0000 0000 0010 0000 0000 0000 0000 0000 0000 0000 ] 
 p4[0] p3[0] p2[256] p1[0] 
p4 = 0xffffffff8021f000
p4->[p3ind]=0x1200000
we have: p3 = 0xffffffff81200000 p2 = 0x1204000 
making p2 virtual: now 0xffffffff81200000 
==flushed TLB==
invalidated: 0x20000000 
task 5 has file len='12408292' mmaped at va 0x20000000 pa 0x41000000 size 12288 kb
mmaped that shitwad loaded at 0x20000000
init doom
calling doom main!
 put char   32 
 put char   32 
 put char   32 
 put char   32 
 put char   32 
 put char   32 
 put char   32 
 put char   32 
 put char   32 
 put char   32 
 put char   32 
 put char   32 
 put char   32 
 put char   32 
 put char   32 
 put char   32 
 put char   32 
 put char   32 
 put char   32 
 put char   32 
 put char   32 
 put char   32 
 put char   32 
 put char   32 
 put char   32 
 put char   32 
 put char   32 
Doom Generic 0.1Z_Init: Init zone memory allocation daemon. 
expanding heap for task 5 [6291456]
pmm_alloc(0x600000): found space for 3 pages at 0x41e00000
map_phys_addr():  0x40600000 -> 0x400000 | 2 pages 
idx for VA: 0x400000 [0b0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0100 0000 0000 0000 0000 0000 ] 
 p4[0] p3[0] p2[2] p1[0] 
p4 = 0x21f000
p4 = 0xffffffff8021f000
p4->[p3ind]=0x1200000
initial p3 = 0xffffffff81200000 p4 = 0xffffffff8021f000, p3_phys = 0xffffffff8020b3e8  
we have: p3 = 0xffffffff81200000 p2 = 0x1204000 
making p3 virtual: now 0xffffffff81200000 
making p2 virtual: now 0xffffffff81200000 
entry 0 @ 0xffffffff81204080 = 0x40600087 
 0b0000 0000 0000 0000 0000 0000 0000 0000 0100 0000 0110 0000 0000 0000 1000 0111 
entry 1 @ 0xffffffff812040c0 = 0x40800087 
 0b0000 0000 0000 0000 0000 0000 0000 0000 0100 0000 1000 0000 0000 0000 1000 0111 
==flushed TLB==
invalidated: 0x400000 
map_user_page_tables:  0x41e00000 -> 0xa00000 | 3 pages 
idx for VA: 0xa00000 [0b0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 1010 0000 0000 0000 0000 0000 ] 
 p4[0] p3[0] p2[5] p1[0] 
unmap_phys_addr():  unmapping 0x400000  | 2 pages 
idx for VA: 0x400000 [0b0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0100 0000 0000 0000 0000 0000 ] 
 p4[0] p3[0] p2[2] p1[0] 
p4 = 0xffffffff8021f000
p4->[p3ind]=0x1200000
we have: p3 = 0xffffffff81200000 p2 = 0x1204000 
making p2 virtual: now 0xffffffff81200000 
==flushed TLB==
invalidated: 0x400000 
expanded heap for task 5:
        pa 0x40c00000 va0x800000 size 8192 kb 
 cr3 to restore: 0x409fd000 
zone memory: , 0x8fa000 allocated for zone
Using . for configuration and saves
V_Init: allocate screens.
M_LoadDefaults: Load system defaults.
M_LoadDefaults: Binding Variables
M_LoadDefaults: Loaded
W_Init: Init WADfiles.
 adding DOOM.iwad
opened our wad 'file' 0x20000000we are loading WAD
using Serial COM1 for debug out 
boot start
registered interupt handler for [33] at 0xffffffff80211162
registered interupt handler for [32] at 0xffffffff80210e42
registered interupt handler for [105] at 0xffffffff8020ccfd
==init GDT, TSS==
gdt ptr = 0xffffffff80214000, tss ptr = 0xffffffff80214028 tss - gdt = 0x28
stack top = 0xffffffff8021d000 end = 0xffffffff80219000 size = 0x4000
copied GDT tss to 0xffffffff80217bf0
==Reloaded GDT, Loaded TSS==
interupts initialized
==boot initial phase complete==

CPUID available = YES
==Parsing Multiboot2 Header==
Unhandled Multiboot Tag: 10
Found Multiboot Module at 0x22b000. Total: 1
Unhandled Multiboot Tag: 9
Unhandled Multiboot Tag: 5
found VBE
fb @ 0xfc000000 h= 768 p= 4096 
===MULTIBOOT_TAG_TYPE_ACPI_OLD===
==parsed mb2 header==
boot info: BIOS [GRUB 2.12] cmdline='dbg=1 serial=1 hackz=1337' kernel_base=0x200000

==PMM Init==
Available Memory Region [0]:{ @0x0 - 0x9fc00 } size 0x9fc00 [0 MiB] 
Available Memory Region [3]:{ @0x100000 - 0xbffe0000 } size 0xbfee0000 [3070 MiB] 
Available Memory Region [7]:{ @0x100000000 - 0x240000000 } size 0x140000000 [5120 MiB] 
Total Memory:
    8388095 KiB  /  8191 MiB  /  7 GiB
 Total Pages: 4095 

for region 0x0 - 0x9fc00 there are 0 pages (r 639 kb) to set free
for region 0x100000 - 0xbffe0000 there are 1535 pages (r 896 kb) to set free
aligned start 0x200000 - aligned end 0xbfe00000 (1 1) 
for region 0x100000000 - 0x240000000 there are 2560 pages (r 0 kb) to set free
marking from kernel phys start 0x200000 to kernel phys end 0x22b000 as used
mark region used: 0x200000 - 0x22b000
marking from 0x200000 - 0x400000 as used, total pages = 1
mark region used: 0x0 - 0xe2b000
marking from 0x0 - 0xe56000 as used, total pages = 7
==PMM End==
mark region used: 0x22b000 - 0x1309060
marking from 0x200000 - 0x13bc0c0 as used, total pages = 8
==init paging==
mark region used: 0xfc000000 - 0xfc300000
marking from 0xfc000000 - 0xfc400000 as used, total pages = 2
unmapping initial identity
palloc_init()
pmm_kalloc(0x400000): found space for 2 pages at 0x1200000
map_phys_addr():  0x1200000 -> 0xffffffff81200000 | 2 pages 
idx for VA: 0xffffffff81200000 [0b1111 1111 1111 1111 1111 1111 1111 1111 1000 0001 0010 0000 0000 0000 0000 0000 ] 
 p4[511] p3[510] p2[9] p1[0] 
p4 = 0x21f000
p4 = 0xffffffff8021f000
p4->[p3ind]=0x223000
initial p3 = 0xffffffff80223000 p4 = 0xffffffff8021f000, p3_phys = 0xffffffff8020b3e8  
we have: p3 = 0xffffffff80223000 p2 = 0x222000 
making p3 virtual: now 0xffffffff80223000 
making p2 virtual: now 0xffffffff80223000 
entry 0 @ 0xffffffff80222240 = 0x1200083 
 0b0000 0000 0000 0000 0000 0000 0000 0000 0000 0001 0010 0000 0000 0000 1000 0011 
entry 1 @ 0xffffffff80222280 = 0x1400083 
 0b0000 0000 0000 0000 0000 0000 0000 0000 0000 0001 0100 0000 0000 0000 1000 0011 
==flushed TLB==
invalidated: 0xffffffff81200000 
page allocator ready at 0xffffffff81200000
mapping framebuffer 0xfc000000 to 0xfc000000
map_phys_addr():  0xfc000000 -> 0xfc000000 | 2 pages 
idx for VA: 0xfc000000 [0b0000 0000 0000 0000 0000 0000 0000 0000 1111 1100 0000 0000 0000 0000 0000 0000 ] 
 p4[0] p3[3] p2[480] p1[0] 
p4 = 0x21f000
p4 = 0xffffffff8021f000
initial p3 = 0x0 p4 = 0xffffffff8021f000, p3_phys = 0xffffffff8020b3e8  
alloc new page table at 0x1200000, virtual 0xffffffff81200000, index now 1 
alloc new page table at 0x1201000, virtual 0xffffffff81201000, index now 2 
made new: **p3 = 0x1200000 p2 = 0x1201000 entry = 0b0000 0000 0000 0000 0000 0000 0000 0000 0000 0001 0010 0000 0000 0000 0000 0111  
we have: p3 = 0x1200000 p2 = 0x1201000 
making p3 virtual: now 0xffffffff81200000 
making p2 virtual: now 0xffffffff81200000 
entry 0 @ 0xffffffff81208800 = 0xfc000083 
 0b0000 0000 0000 0000 0000 0000 0000 0000 1111 1100 0000 0000 0000 0000 1000 0011 
entry 1 @ 0xffffffff81208840 = 0xfc200083 
 0b0000 0000 0000 0000 0000 0000 0000 0000 1111 1100 0010 0000 0000 0000 1000 0011 
==flushed TLB==
invalidated: 0xfc000000 
init_heap()
pmm_kalloc(0x800000): found space for 4 pages at 0x1800000
map_phys_addr():  0x1800000 -> 0xffffbeefed000000 | 4 pages 
idx for VA: 0xffffbeefed000000 [0b1111 1111 1111 1111 1011 1110 1110 1111 1110 1101 0000 0000 0000 0000 0000 0000 ] 
 p4[381] p3[447] p2[360] p1[0] 
p4 = 0x21f000
p4 = 0xffffffff8021f000
initial p3 = 0x0 p4 = 0xffffffff8021f000, p3_phys = 0xffffffff8020b3e8  
alloc new page table at 0x1202000, virtual 0xffffffff81202000, index now 3 
alloc new page table at 0x1203000, virtual 0xffffffff81203000, index now 4 
made new: **p3 = 0x1202000 p2 = 0x1203000 entry = 0b0000 0000 0000 0000 0000 0000 0000 0000 0000 0001 0010 0000 0010 0000 0000 0111  
we have: p3 = 0x1202000 p2 = 0x1203000 
making p3 virtual: now 0xffffffff81202000 
making p2 virtual: now 0xffffffff81202000 
entry 0 @ 0xffffffff81208a00 = 0x1800083 
 0b0000 0000 0000 0000 0000 0000 0000 0000 0000 0001 1000 0000 0000 0000 1000 0011 
entry 1 @ 0xffffffff81208a40 = 0x1a00083 
 0b0000 0000 0000 0000 0000 0000 0000 0000 0000 0001 1010 0000 0000 0000 1000 0011 
entry 2 @ 0xffffffff81208a80 = 0x1c00083 
 0b0000 0000 0000 0000 0000 0000 0000 0000 0000 0001 1100 0000 0000 0000 1000 0011 
entry 3 @ 0xffffffff81208ac0 = 0x1e00083 
 0b0000 0000 0000 0000 0000 0000 0000 0000 0000 0001 1110 0000 0000 0000 1000 0011 
==flushed TLB==
invalidated: 0xffffbeefed000000 
bmap [ 0xffffbeefed000000 ] size=12 
max size = 262130 max_size_bytes = 0x200000 
==paging init ok==
skipping acpi

==MEM INIT OK==
enabled interupts.
==boot second phase complete==
we found no space to fit size 0x45, making new block at 0xffffbeefed200000 size=94 /  footer @ 0xffffbeefed200052 
adding to alloc map, prev. # allocs = 12 
 added to alloc map, new # allocs = 13 
freeing block at 0xffffbeefed200000 / block_size=81 
block freed, size of allocs = 13 
===initrd: loading 17686624 bytes from 0x22b000===
initrd validated; contains 17682824 bytes of files!
we found no space to fit size 0x1425, making new block at 0xffffbeefed20005e size=5182 /  footer @ 0xffffbeefed201490 
adding to alloc map, prev. # allocs = 13 
 added to alloc map, new # allocs = 14 
we found no space to fit size 0x5aa, making new block at 0xffffbeefed20149c size=1475 /  footer @ 0xffffbeefed201a53 
adding to alloc map, prev. # allocs = 14 
 added to alloc map, new # allocs = 15 
added dir node mod 
added dir node local 
added dir node libnest 
added dir node lib 
added dir node usr 
added dir node books 
added dir node etc 
added dir node birds 
added dir node bin 
added file node ulysses.txt 
added file node LICENSE.txt 
added file node initrd.txt 
added file node etcetera.txt 
added file node init 
added file node ls 
added file node DOOM.iwad 
added file node usermode 
added file node doomos 
added file node loco.txt 
added file node usrlocal.txt 
added file node libd.so 
added file node imaginehavingalongfilenamewellyoudonthavetoanymore.txt 
added file node greenland.bmp 
added file node birdnest.nice 
added file node testcase.txt 
==initrd load success!== 

file init is valid elf64. loading..
phdr load  vaddr = 0x400000, aligned to 0x1000, X  R  
phdr load  vaddr = 0x403000, aligned to 0x1000,  W R  
lowest vaddr 0x400000 highest vaddr 0x4037a0, size 0x200000
pmm_alloc(0x400000): found space for 2 pages at 0x40000000
map_phys_addr():  0x40000000 -> 0x400000 | 2 pages 
idx for VA: 0x400000 [0b0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0100 0000 0000 0000 0000 0000 ] 
 p4[0] p3[0] p2[2] p1[0] 
p4 = 0x21f000
p4 = 0xffffffff8021f000
p4->[p3ind]=0x1200000
initial p3 = 0xffffffff81200000 p4 = 0xffffffff8021f000, p3_phys = 0xffffffff8020b3e8  
alloc new page table at 0x1204000, virtual 0xffffffff81204000, index now 5 
made new: p2
we have: p3 = 0xffffffff81200000 p2 = 0x1204000 
making p3 virtual: now 0xffffffff81200000 
making p2 virtual: now 0xffffffff81200000 
entry 0 @ 0xffffffff81204080 = 0x40000087 
 0b0000 0000 0000 0000 0000 0000 0000 0000 0100 0000 0000 0000 0000 0000 1000 0111 
entry 1 @ 0xffffffff812040c0 = 0x40200087 
 0b0000 0000 0000 0000 0000 0000 0000 0000 0100 0000 0010 0000 0000 0000 1000 0111 
==flushed TLB==
invalidated: 0x400000 
allocated user pages: [phys address] =  p4 0x403fd000 p3 0x403fe000 p2 0x403ff000
 [virt] vstart = 0x400000 vend = 0x800000, size palign 0x200000 size total 0x400000
map_user_page_tables:  0x40000000 -> 0x400000 | 2 pages 
idx for VA: 0x400000 [0b0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0100 0000 0000 0000 0000 0000 ] 
 p4[0] p3[0] p2[2] p1[0] 
kp4 phys = 0x21f000
kp4 virt = 0xffffffff8021f000
copying kp4 at idx 511 (contents 0x223023) to user p4
idx for VA: 0x400000 [0b0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0100 0000 0000 0000 0000 0000 ] 
 p4[0] p3[0] p2[2] p1[0] 
idx for VA: 0xffffbeefed000000 [0b1111 1111 1111 1111 1011 1110 1110 1111 1110 1101 0000 0000 0000 0000 0000 0000 ] 
 p4[381] p3[447] p2[360] p1[0] 
idx for VA: 0xfc000000 [0b0000 0000 0000 0000 0000 0000 0000 0000 1111 1100 0000 0000 0000 0000 0000 0000 ] 
 p4[0] p3[3] p2[480] p1[0] 
usr stack @ 0x7fd000, size = 4070 kb
copying header 0x400000 to 0x400000. fs= 0x2ee8 ms = 0x2ee8
copying header 0x403000 to 0x403000. fs= 0x618 ms = 0x7a0
unmap_phys_addr():  unmapping 0x400000  | 2 pages 
idx for VA: 0x400000 [0b0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0100 0000 0000 0000 0000 0000 ] 
 p4[0] p3[0] p2[2] p1[0] 
p4 = 0xffffffff8021f000
p4->[p3ind]=0x1200000
we have: p3 = 0xffffffff81200000 p2 = 0x1204000 
making p2 virtual: now 0xffffffff81200000 
==flushed TLB==
invalidated: 0x400000 
loaded ELF: init [14240 kb]
 usr entry = 0x4005fb usr phys = 0x40000000 usr lo 0x400000 usr rsp 0x7fd000, usr cr3 = 0x403fd000
we found no space to fit size 0x1000, making new block at 0xffffbeefed201a5f size=4121 /  footer @ 0xffffbeefed202a6c 
adding to alloc map, prev. # allocs = 15 
 added to alloc map, new # allocs = 16 

=== stdout init @ 0xffffbeefed201a6c size 4096 idx 0  ready = 1 ===
Graphics Init 1024 x 768 x 32 ready = 1 
tasking init

we found no space to fit size 0x2000, making new block at 0xffffbeefed202a78 size=8217 /  footer @ 0xffffbeefed204a85 
adding to alloc map, prev. # allocs = 16 
 added to alloc map, new # allocs = 17 
stack  0xffffbeefed204974 isn't aligned! repairing to = 0xffffbeefed204970 
create_task task_kmain pid 0 rip 0xffffffff80201787 !
added initial task task_kmain pid 0 !
adding task task_drawstdout, pid_last = 1 !
we found no space to fit size 0x2000, making new block at 0xffffbeefed204a91 size=8217 /  footer @ 0xffffbeefed206a9e 
adding to alloc map, prev. # allocs = 17 
 added to alloc map, new # allocs = 18 
stack  0xffffbeefed20698d isn't aligned! repairing to = 0xffffbeefed206980 
create_task task_drawstdout pid 1 rip 0xffffffff80201954 !
scheduler: added task task_drawstdout, pid = 1 !
adding task task_exit_test, pid_last = 2 !
we found no space to fit size 0x2000, making new block at 0xffffbeefed206aaa size=8217 /  footer @ 0xffffbeefed208ab7 
adding to alloc map, prev. # allocs = 18 
 added to alloc map, new # allocs = 19 
stack  0xffffbeefed2089a6 isn't aligned! repairing to = 0xffffbeefed2089a0 
create_task task_exit_test pid 2 rip 0xffffffff80201a43 !
scheduler: added task task_exit_test, pid = 2 !
adding task task_yield_test, pid_last = 3 !
we found no space to fit size 0x2000, making new block at 0xffffbeefed208ac3 size=8217 /  footer @ 0xffffbeefed20aad0 
adding to alloc map, prev. # allocs = 19 
 added to alloc map, new # allocs = 20 
stack  0xffffbeefed20a9bf isn't aligned! repairing to = 0xffffbeefed20a9b0 
create_task task_yield_test pid 3 rip 0xffffffff80201a74 !
scheduler: added task task_yield_test, pid = 3 !
adding USER task usermode, pid_last = 4 !
we found no space to fit size 0x2000, making new block at 0xffffbeefed20aadc size=8217 /  footer @ 0xffffbeefed20cae9 
adding to alloc map, prev. # allocs = 20 
 added to alloc map, new # allocs = 21 
stack  0xffffbeefed20c9d8 isn't aligned! repairing to = 0xffffbeefed20c9d0 
create_task usermode pid 4 rip 0x4005fb !
we found no space to fit size 0x70, making new block at 0xffffbeefed20caf5 size=137 /  footer @ 0xffffbeefed20cb72 
adding to alloc map, prev. # allocs = 21 
 added to alloc map, new # allocs = 22 
scheduler: added USER task usermode, pid = 4 !
randos up 
starting first task task_kmain
starting task task_kmain
task draw timer 
task draw test 
task exit test 
task 2 exited with code: 0
found task task_drawstdout pointing to del task task_exit_test
old parent pid = 65535
yield testI am a user task hard at work
please mr kernel give me cpu time

112$>>> yieldingyieldingmput char m 109 
aput char a 97 
yieldinglput char l 108 
lput char l 108 
oput char o 111 
cput char c 99 
put char  13 
yielding 
unknown command: doommalloc

4217$>>> yield test overtask 3 exited with code: 0
found task task_drawstdout pointing to del task task_yield_test
old parent pid = 65535
mput char m 109 
aput char a 97 
lput char l 108 
lput char l 108 
oput char o 111 
cput char c 99 
put char  13 
 

 task_mmap_file(): DOOM.iwad to be mmaped in 6 pages from 0xffffffff803ababb
pmm_alloc(0xc00000): found space for 6 pages at 0x40600000
map_phys_addr():  0x40000000 -> 0x400000 | 2 pages 
idx for VA: 0x400000 [0b0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0100 0000 0000 0000 0000 0000 ] 
 p4[0] p3[0] p2[2] p1[0] 
p4 = 0x21f000
p4 = 0xffffffff8021f000
p4->[p3ind]=0x1200000
initial p3 = 0xffffffff81200000 p4 = 0xffffffff8021f000, p3_phys = 0xffffffff8020b3e8  
we have: p3 = 0xffffffff81200000 p2 = 0x1204000 
making p3 virtual: now 0xffffffff81200000 
making p2 virtual: now 0xffffffff81200000 
entry 0 @ 0xffffffff81204080 = 0x40000087 
 0b0000 0000 0000 0000 0000 0000 0000 0000 0100 0000 0000 0000 0000 0000 1000 0111 
entry 1 @ 0xffffffff812040c0 = 0x40200087 
 0b0000 0000 0000 0000 0000 0000 0000 0000 0100 0000 0010 0000 0000 0000 1000 0111 
==flushed TLB==
invalidated: 0x400000 
map_phys_addr():  0x40600000 -> 0x20000000 | 6 pages 
idx for VA: 0x20000000 [0b0000 0000 0000 0000 0000 0000 0000 0000 0010 0000 0000 0000 0000 0000 0000 0000 ] 
 p4[0] p3[0] p2[256] p1[0] 
p4 = 0x21f000
p4 = 0xffffffff8021f000
p4->[p3ind]=0x1200000
initial p3 = 0xffffffff81200000 p4 = 0xffffffff8021f000, p3_phys = 0xffffffff8020b3e8  
we have: p3 = 0xffffffff81200000 p2 = 0x1204000 
making p3 virtual: now 0xffffffff81200000 
making p2 virtual: now 0xffffffff81200000 
entry 0 @ 0xffffffff81208000 = 0x40600087 
 0b0000 0000 0000 0000 0000 0000 0000 0000 0100 0000 0110 0000 0000 0000 1000 0111 
entry 1 @ 0xffffffff81208040 = 0x40800087 
 0b0000 0000 0000 0000 0000 0000 0000 0000 0100 0000 1000 0000 0000 0000 1000 0111 
entry 2 @ 0xffffffff81208080 = 0x40a00087 
 0b0000 0000 0000 0000 0000 0000 0000 0000 0100 0000 1010 0000 0000 0000 1000 0111 
entry 3 @ 0xffffffff812080c0 = 0x40c00087 
 0b0000 0000 0000 0000 0000 0000 0000 0000 0100 0000 1100 0000 0000 0000 1000 0111 
entry 4 @ 0xffffffff81208100 = 0x40e00087 
 0b0000 0000 0000 0000 0000 0000 0000 0000 0100 0000 1110 0000 0000 0000 1000 0111 
entry 5 @ 0xffffffff81208140 = 0x41000087 
 0b0000 0000 0000 0000 0000 0000 0000 0000 0100 0001 0000 0000 0000 0000 1000 0111 
==flushed TLB==
invalidated: 0x20000000 
map_user_page_tables:  0x40600000 -> 0x20000000 | 6 pages 
idx for VA: 0x20000000 [0b0000 0000 0000 0000 0000 0000 0000 0000 0010 0000 0000 0000 0000 0000 0000 0000 ] 
 p4[0] p3[0] p2[256] p1[0] 
unmap_phys_addr():  unmapping 0x400000  | 2 pages 
idx for VA: 0x400000 [0b0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0100 0000 0000 0000 0000 0000 ] 
 p4[0] p3[0] p2[2] p1[0] 
p4 = 0xffffffff8021f000
p4->[p3ind]=0x1200000
we have: p3 = 0xffffffff81200000 p2 = 0x1204000 
making p2 virtual: now 0xffffffff81200000 
==flushed TLB==
invalidated: 0x400000 
unmap_phys_addr():  unmapping 0x20000000  | 6 pages 
idx for VA: 0x20000000 [0b0000 0000 0000 0000 0000 0000 0000 0000 0010 0000 0000 0000 0000 0000 0000 0000 ] 
 p4[0] p3[0] p2[256] p1[0] 
p4 = 0xffffffff8021f000
p4->[p3ind]=0x1200000
we have: p3 = 0xffffffff81200000 p2 = 0x1204000 
making p2 virtual: now 0xffffffff81200000 
==flushed TLB==
invalidated: 0x20000000 
task 4 has file len='12408292' mmaped at va 0x20000000 pa 0x40600000 size 12288 kb
mmaped that shitdid we do it???mmap wad 0x20000000
8984$>>> 1put char 1 49 
put char  8 
dput char d 100 
oput char o 111 
oput char o 111 
mput char m 109 
put char  13 
 
found space at 0. need size 0x6 found size 0x51 
using existing block at 0xffffbeefed200000 / block_size=81 
exec_user_task(): old cr3 0x403fd000 new cr3 0x21f000 insane 0x403fd000 wtf 0xffffbeefed200008
file doomos is valid elf64. loading..
phdr load  vaddr = 0x400000, aligned to 0x1000, X  R  
phdr load  vaddr = 0x471120, aligned to 0x1000,  W R  
lowest vaddr 0x400000 highest vaddr 0x4d5500, size 0x200000
pmm_alloc(0x400000): found space for 2 pages at 0x41400000
map_phys_addr():  0x41400000 -> 0x400000 | 2 pages 
idx for VA: 0x400000 [0b0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0100 0000 0000 0000 0000 0000 ] 
 p4[0] p3[0] p2[2] p1[0] 
p4 = 0x21f000
p4 = 0xffffffff8021f000
p4->[p3ind]=0x1200000
initial p3 = 0xffffffff81200000 p4 = 0xffffffff8021f000, p3_phys = 0xffffffff8020b3e8  
we have: p3 = 0xffffffff81200000 p2 = 0x1204000 
making p3 virtual: now 0xffffffff81200000 
making p2 virtual: now 0xffffffff81200000 
entry 0 @ 0xffffffff81204080 = 0x41400087 
 0b0000 0000 0000 0000 0000 0000 0000 0000 0100 0001 0100 0000 0000 0000 1000 0111 
entry 1 @ 0xffffffff812040c0 = 0x41600087 
 0b0000 0000 0000 0000 0000 0000 0000 0000 0100 0001 0110 0000 0000 0000 1000 0111 
==flushed TLB==
invalidated: 0x400000 
allocated user pages: [phys address] =  p4 0x417fd000 p3 0x417fe000 p2 0x417ff000
 [virt] vstart = 0x400000 vend = 0x800000, size palign 0x200000 size total 0x400000
map_user_page_tables:  0x41400000 -> 0x400000 | 2 pages 
idx for VA: 0x400000 [0b0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0100 0000 0000 0000 0000 0000 ] 
 p4[0] p3[0] p2[2] p1[0] 
kp4 phys = 0x21f000
kp4 virt = 0xffffffff8021f000
copying kp4 at idx 511 (contents 0x223023) to user p4
idx for VA: 0x400000 [0b0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0100 0000 0000 0000 0000 0000 ] 
 p4[0] p3[0] p2[2] p1[0] 
idx for VA: 0xffffbeefed000000 [0b1111 1111 1111 1111 1011 1110 1110 1111 1110 1101 0000 0000 0000 0000 0000 0000 ] 
 p4[381] p3[447] p2[360] p1[0] 
idx for VA: 0xfc000000 [0b0000 0000 0000 0000 0000 0000 0000 0000 1111 1100 0000 0000 0000 0000 0000 0000 ] 
 p4[0] p3[3] p2[480] p1[0] 
usr stack @ 0x7fd000, size = 3230 kb
copying header 0x400000 to 0x400000. fs= 0x70118 ms = 0x70118
copying header 0x471120 to 0x471120. fs= 0x21c78 ms = 0x643e0
unmap_phys_addr():  unmapping 0x400000  | 2 pages 
idx for VA: 0x400000 [0b0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0100 0000 0000 0000 0000 0000 ] 
 p4[0] p3[0] p2[2] p1[0] 
p4 = 0xffffffff8021f000
p4->[p3ind]=0x1200000
we have: p3 = 0xffffffff81200000 p2 = 0x1204000 
making p2 virtual: now 0xffffffff81200000 
==flushed TLB==
invalidated: 0x400000 
loaded ELF: doomos [873728 kb]
exec_user_task():
     usr entry = 0x43ebc5 usr phys = 0x41400000 usr lo 0x400000 usr rsp 0x7fd000, usr cr3 = 0x417fd000
adding USER task doomos, child of 4 !
we found no space to fit size 0x2000, making new block at 0xffffbeefed20cb7e size=8217 /  footer @ 0xffffbeefed20eb8b 
adding to alloc map, prev. # allocs = 22 
 added to alloc map, new # allocs = 23 
stack  0xffffbeefed20ea7a isn't aligned! repairing to = 0xffffbeefed20ea70 
create_task doomos pid 5 rip 0x43ebc5 !
we found no space to fit size 0x70, making new block at 0xffffbeefed20eb97 size=137 /  footer @ 0xffffbeefed20ec14 
adding to alloc map, prev. # allocs = 23 
 added to alloc map, new # allocs = 24 
scheduler: added child user task doomos, pid = 5 !
scheduler: swapping back cr3 to 0x403fd000
starting doom!
created frame buffer
mmap WAD

 task_mmap_file(): DOOM.iwad to be mmaped in 6 pages from 0xffffffff803ababb
pmm_alloc(0xc00000): found space for 6 pages at 0x41a00000
map_phys_addr():  0x41400000 -> 0x400000 | 2 pages 
idx for VA: 0x400000 [0b0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0100 0000 0000 0000 0000 0000 ] 
 p4[0] p3[0] p2[2] p1[0] 
p4 = 0x21f000
p4 = 0xffffffff8021f000
p4->[p3ind]=0x1200000
initial p3 = 0xffffffff81200000 p4 = 0xffffffff8021f000, p3_phys = 0xffffffff8020b3e8  
we have: p3 = 0xffffffff81200000 p2 = 0x1204000 
making p3 virtual: now 0xffffffff81200000 
making p2 virtual: now 0xffffffff81200000 
entry 0 @ 0xffffffff81204080 = 0x41400087 
 0b0000 0000 0000 0000 0000 0000 0000 0000 0100 0001 0100 0000 0000 0000 1000 0111 
entry 1 @ 0xffffffff812040c0 = 0x41600087 
 0b0000 0000 0000 0000 0000 0000 0000 0000 0100 0001 0110 0000 0000 0000 1000 0111 
==flushed TLB==
invalidated: 0x400000 
map_phys_addr():  0x41a00000 -> 0x20000000 | 6 pages 
idx for VA: 0x20000000 [0b0000 0000 0000 0000 0000 0000 0000 0000 0010 0000 0000 0000 0000 0000 0000 0000 ] 
 p4[0] p3[0] p2[256] p1[0] 
p4 = 0x21f000
p4 = 0xffffffff8021f000
p4->[p3ind]=0x1200000
initial p3 = 0xffffffff81200000 p4 = 0xffffffff8021f000, p3_phys = 0xffffffff8020b3e8  
we have: p3 = 0xffffffff81200000 p2 = 0x1204000 
making p3 virtual: now 0xffffffff81200000 
making p2 virtual: now 0xffffffff81200000 
entry 0 @ 0xffffffff81208000 = 0x41a00087 
 0b0000 0000 0000 0000 0000 0000 0000 0000 0100 0001 1010 0000 0000 0000 1000 0111 
entry 1 @ 0xffffffff81208040 = 0x41c00087 
 0b0000 0000 0000 0000 0000 0000 0000 0000 0100 0001 1100 0000 0000 0000 1000 0111 
entry 2 @ 0xffffffff81208080 = 0x41e00087 
 0b0000 0000 0000 0000 0000 0000 0000 0000 0100 0001 1110 0000 0000 0000 1000 0111 
entry 3 @ 0xffffffff812080c0 = 0x42000087 
 0b0000 0000 0000 0000 0000 0000 0000 0000 0100 0010 0000 0000 0000 0000 1000 0111 
entry 4 @ 0xffffffff81208100 = 0x42200087 
 0b0000 0000 0000 0000 0000 0000 0000 0000 0100 0010 0010 0000 0000 0000 1000 0111 
entry 5 @ 0xffffffff81208140 = 0x42400087 
 0b0000 0000 0000 0000 0000 0000 0000 0000 0100 0010 0100 0000 0000 0000 1000 0111 
==flushed TLB==
invalidated: 0x20000000 
map_user_page_tables:  0x41a00000 -> 0x20000000 | 6 pages 
idx for VA: 0x20000000 [0b0000 0000 0000 0000 0000 0000 0000 0000 0010 0000 0000 0000 0000 0000 0000 0000 ] 
 p4[0] p3[0] p2[256] p1[0] 
unmap_phys_addr():  unmapping 0x400000  | 2 pages 
idx for VA: 0x400000 [0b0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0100 0000 0000 0000 0000 0000 ] 
 p4[0] p3[0] p2[2] p1[0] 
p4 = 0xffffffff8021f000
p4->[p3ind]=0x1200000
we have: p3 = 0xffffffff81200000 p2 = 0x1204000 
making p2 virtual: now 0xffffffff81200000 
==flushed TLB==
invalidated: 0x400000 
unmap_phys_addr():  unmapping 0x20000000  | 6 pages 
idx for VA: 0x20000000 [0b0000 0000 0000 0000 0000 0000 0000 0000 0010 0000 0000 0000 0000 0000 0000 0000 ] 
 p4[0] p3[0] p2[256] p1[0] 
p4 = 0xffffffff8021f000
p4->[p3ind]=0x1200000
we have: p3 = 0xffffffff81200000 p2 = 0x1204000 
making p2 virtual: now 0xffffffff81200000 
==flushed TLB==
invalidated: 0x20000000 
task 5 has file len='12408292' mmaped at va 0x20000000 pa 0x41a00000 size 12288 kb
mmaped that shitwad loaded at 0x20000000o0x2'*Á~À$À!ÀÀÀÀÀÀ@##$Ÿ¤XÀÀ	ÀÀÀÀÀ
init doom
calling doom main!
 put char   32 
 put char   32 
 put char   32 
 put char   32 
 put char   32 
 put char   32 
 put char   32 
 put char   32 
 put char   32 
 put char   32 
 put char   32 
 put char   32 
 put char   32 
 put char   32 
 put char   32 
 put char   32 
 put char   32 
 put char   32 
 put char   32 
 put char   32 
 put char   32 
 put char   32 
 put char   32 
 put char   32 
 put char   32 
 put char   32 
 put char   32 
Doom Generic 0.1Z_Init: Init zone memory allocation daemon. 
zone memory: , 0x4011efaa@?ÁF@<ÁNÀ:ÁU!$@7Á\@5Ac#¤`Ÿª]@2Á20000000o0x20000000o0x2'*Á~À$À!ÀÀÀÀÀÀ@##$Ÿ¤XÀÀ	ÀÀÀÀÀ allocated for zone

=== GPF ===
Error: 0 
rbp 0x7fcda8 
==============
===isr[0xd] err{0x0}====
err_code = 0x0
rbp = 0x7fcda8
rip = 0x43d542
rsp = 0x7fcd98
cs = 0x1b
rflags = 0x10246
cr3 = 0x417fd000
ds = 0x23
ss = 0x23
rax = 0x3c155034011efaa
rbx = 0x0
rcx = 0x0
rdx = 0x600000
rdi = 0x7fc838
rsi = 0x10
r8 = 0xffffffff80211649
r9 = 0x0
r10 = 0x0
r11 = 0x0
r12 = 0x0
r13 = 0x0
r14 = 0x0
r15 = 0x0

=== GPF ===
Error: 0 
rbp 0x7fcda8 
==============
===isr[0xd] err{0x0}====
err_code = 0x0
rbp = 0x7fcda8
rip = 0x43d542
rsp = 0x7fcd98
cs = 0x1b
rflags = 0x10246
cr3 = 0x417fd000
ds = 0x23
ss = 0x23
rax = 0x3c155034011efaa
rbx = 0x0
rcx = 0x0
rdx = 0x600000
rdi = 0x7fc838
rsi = 0x10
r8 = 0xffffffff80211649
r9 = 0x0
r10 = 0x0
r11 = 0x0
r12 = 0x0
r13 = 0x0
r14 = 0x0
r15 = 0x0
